---
title: "Примери"
author: "Boyko Amarov"
date: "10/17/2021"
output: html_document
---

## Графичен метод

```{r}
# install.packages("matlib")
library(tidyverse)
library(matlib)
options(scipen=999)
```


### Планиране на производство

Бутиково кафене в София предлага два продукта: Супер еспресо и Делукс. За 
приготвянето на един килограм от първия вид кафе са необходими по равни части 
бразилско и кубинско кафе, а рецептата за Делукс предвижда смес от бразилско и 
кубинско кафе в пропорция 1 към 3. Доставчиците са готови да осигурят 120 кг
бразилско и 160 кг. кубинско кафе. От всеки продаден килограм Супер еспресо 
заведението печели 40 лв., докато за печалбата на килограм Делукс възлиза на 
50 лв. Заведението знае, че няма да може да продаде повече от 
150 кв. Супер еспресо.

Колко от двата типа кафе ще препоръчате на кафенето да смеси?

### Математически модел


### Допустимо множество

```{r}
tribble(
  ~constr, ~x, ~y,
  "1: Бразилско кафе", 0, 120 / 0.25,
  "1: Бразилско кафе", 120 / 0.5, 0,
  "2: Кубинско кафе", 0, 160 / 0.75,
  "2: Кубинско кафе", 160 / 0.5, 0,
  "3: Търсене супер еспр.", 0, 150,
  "3: Търсене супер еспр.", 300, 150,
) %>%
  ggplot(aes(x = x, y = y)) +
    geom_point(aes(color = constr)) +
    geom_line(aes(color = constr)) +
    geom_segment(
      data = tibble(x = 0, y = 0, xend = 40, yend = 50),
      aes(x = x, y = y, xend = xend, yend = yend),
      arrow = arrow(
        length=unit(0.15,"cm"),
        ends="last",
        type = "closed")
    ) +
    # geom_abline(intercept = c(5160 / 60, 5500 / 60), slope = - 40 / 60, linetype = 2) +
    labs(
      colour = "Ограничение",
      x = expression(paste(x[1], " Супер еспресо, кг.")),
      y = expression(paste(x[2], " Делукс, кг.")),
    ) +
  geom_polygon(
    data = tribble(
      ~x, ~y, 
      0, 0, 
      240, 0,
      200, 80,
      95, 150,
      0, 150
      ),
    fill = "firebrick4",
    alpha = 0.2
  ) +
  annotate("text", x = 0, y = 0, label = "(0, 0)", size = 3) +
  annotate("text", x = 240, y = 0, label = "(240, 0)", size = 3) +
  annotate("text", x = 200, y = 80, label = "(200, 80)", size = 3) +
  annotate("text", x = 95, y = 150, label = "(95, 150)", size = 3) +
  annotate("text", x = 200, y = 80, label = "(200, 80)", size = 3) +
  annotate("text", x = 0, y = 150, label = "(0, 150)", size = 3)
```
```{r}
A <- matrix(c(
  1 / 2, 1 / 4,
  1 / 2, 3 / 4,
  0, 1
  ),
  ncol = 2,
  byrow = TRUE
)

b <- c(40, 50)
r <- c(120, 160, 150)

gMOIP::plotPolytope(
  A = A, 
  b = r, 
  obj = b, 
  crit = "max", 
  plotFeasible = TRUE,
  labels = "coord",
  plotFaces = TRUE,
  # plotOptimum = TRUE
  ) +
  labs(
    x = expression(paste(x[1], " (Супер еспресо кг.)")),
    y = expression(paste(x[2], " (Делукс, кг.)"))
  )
```

### Целева функция, нормален вектор

### Оптимален план

### Реализация в `Excel`

[Линк](https://github.com/feb-uni-sofia/linprog-2021-2022/raw/main/excel/Problem_2_coffee_blending.xlsx) към пример за реализация в Excel.

### Реализация в `R`

```{r}
result <- lpSolve::lp(
  direction = "max", ## Вид оптимизация: min/max
  objective.in = b, ## Objective, коефициенти на целевата функция
  const.mat = A, ## Constraints matrix, матрица с коефициенти на ограниченията
  const.dir = "<=", ## Constraints direction, посока на неравенствата
  const.rhs = r, ## Right hand side, дясна страна на ограниченията
  compute.sens=TRUE
)
```

```{r}
result
```


```{r}
result$solution
```

```{r}
result$duals
```
```{r}
result$duals.from
```

```{r}
result$duals.to
```

```{r}
result$sens.coef.from
```
```{r}
result$sens.coef.to
```

```{r}
A
```
```{r}
r
```

```{r}
showEqn(A, r)
```
```{r}
eqns <- c(1, 2)
Solve(A[eqns, ], r[eqns])
```

```{r}
eqns <- c(2, 3)
Solve(A[eqns, ], r[eqns])
```

```{r}
eqns <- c(1, 3)
Solve(A[eqns, ], r[eqns])
```

### Дефицитност на ресурси

Кои ресурси са дефицитни в намерения оптимален план?

### Допустими граници на промяна

- В какви граници може да се променя ограничението за бразилското кафе без
да се промени оптималния план?

- В какви граници може да се променя ограничението за кубинското кафе без
да се промени оптималния план?

- В какви граници може да се променя ограничението за търсенето на Супер еспресо кафе без
да се промени оптималния план?

### Скрити цени

- Доставчикът предлага да достави допълнителни 10 кг. кубинско кафе на цена от
20 лв./кг. Бихте ли препоръчали тази оферта на заведението?

- Доставчикът предлага да достави допълнителни 10 кг. бразилско кафе на цена от
40 лв./кг. Бихте ли препоръчали тази оферта на заведението?

## Планиране на производство (2)

Фирма, специализирана в производство на зимни палта се опитва да посрещне 
търсенето за нейните стоки с възможно най-малки разходи. Търсенето на палта 
има силни сезонни колебания и фирмата има три опции, за да отговори на сезонните
вариации. В началото на годината фирмата разполага с 30 работника. Всеки от 
работниците може да произведе до 80 палта на сезон (от три месеца). 
Заплатата на всеки работник е 2000 лв. на месец.


- работниците могат да работят и по-продължително, но допълнителният труд се
  заплаща 50% по-скъпо и работниците могат да работят не повече от 20% повече
  от нормалното работно време.
- Произведени в предишния период палта могат да се складират на цена от 12 лв.
  на сезон за всяко палто.
- Фирмата може да назначава и освобождава служители на цени 500 лв. за назначаване 
  и 420 за освобождаване на служите.
- Фирмата няма начални запаси от готови палта

Изгответе математически модел с който да намерите оптималния план 
(в смисъл на най-ниски разходи) за тази фирма.





